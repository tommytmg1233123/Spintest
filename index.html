<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RNG World</title>

<style>
body{
    margin:0;
    overflow:hidden;
    font-family:Arial;
}

/* ===== STATS BAR ===== */

#stats{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    background:#000000aa;
    color:white;
    padding:10px 20px;
    font-size:20px;
    display:flex;
    gap:30px;
    z-index:20;
}

/* ===== WORLD ===== */

#world{
    position:fixed;
    inset:0;
    background:#1a1a1a;
    overflow:hidden;
}

.ground{
    position:absolute;
    bottom:0;
    height:180px;
    width:100%;
    background:#1a1a1a;
}

/* NEW TREE STYLE â€” using your PNG */
.tree{
    position:absolute;
    bottom:180px;
    width:120px;
    height:160px;
    background:url("https://i.imgur.com/AcBA0Pi.jpeg") no-repeat center/contain;
}

/* RIVER */
.river{
    position:absolute;
    bottom:0;
    height:120px;
    width:200px;
    background:#1a1a1a;
}

/* ===== WHEEL TOP ===== */

#wheelWrap{
    position:fixed;
    top:60px;
    left:50%;
    transform:translateX(-50%);
    width:900px;
    height:140px;
    overflow:hidden;
    background:#111;
    border:3px solid white;
    border-radius:12px;
}

#wheel{
    display:flex;
}

.item{
    width:140px;
    height:140px;
    margin:0 4px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#222;
    border-radius:10px;
}

.item img{
    width:120px;
    height:120px;
    border-radius:8px;
}

/* PIN TOP */

#pin{
    position:fixed;
    top:40px;
    left:50%;
    transform:translateX(-50%);
    font-size:50px;
    color:red;
    z-index:10;
}

/* ===== BUTTONS BOTTOM ===== */

#ui{
    position:fixed;
    bottom:30px;
    left:50%;
    transform:translateX(-50%);
    text-align:center;
}

#spinBtn{
    padding:16px 70px;
    font-size:28px;
    border-radius:14px;
    border:none;
    background:#00e5ff;
    color:white;
    cursor:pointer;
}

#skipBtn{
    margin-top:8px;
    padding:6px 25px;
}

#musicToggle{
    margin-top:8px;
    padding:6px 25px;
    margin-left:10px;
}

/* ===== POPUP ===== */

#popup{
    position:fixed;
    top:40%;
    left:50%;
    transform:translateX(-50%);
    font-size:60px;
    font-weight:bold;
    display:none;
}

/* FLASH */

#flash{
    position:fixed;
    inset:0;
    opacity:0;
    pointer-events:none;
    transition:opacity .2s;
}
</style>
</head>

<body>

<!-- ===== STATS BAR ===== -->
<div id="stats">
    <div>Total Spins: <span id="s_total">0</span></div>
    <div>Common: <span id="s_common">0</span></div>
    <div>Rare: <span id="s_rare">0</span></div>
    <div>Ultra: <span id="s_ultra">0</span></div>
    <div>Mythic: <span id="s_mythic">0</span></div>
    <div>Divine: <span id="s_divine">0</span></div>
</div>

<div id="world">
    <div class="ground"></div>

    <div class="tree" style="left:400px"></div>
    <div class="tree" style="left:900px"></div>

    <div class="river" style="left:600px"></div>
    <div class="river" style="left:1400px"></div>
</div>

<div id="pin">â–¼</div>

<div id="wheelWrap">
    <div id="wheel"></div>
</div>

<div id="ui">
    <button id="spinBtn">SPIN</button><br>
    <button id="skipBtn">Skip</button>
    <button id="musicToggle">ðŸ”Š Music ON</button>
</div>

<div id="popup"></div>
<div id="flash"></div>

<audio id="bgMusic" loop volume="0.3"></audio>
<audio id="tick" src="tick.mp3"></audio>
<audio id="spinSound" src="spin.mp3"></audio>

<script>

/* ===== BACKGROUND MUSIC ===== */

let musicEnabled=true;
const bgMusic=document.getElementById("bgMusic");

// Using a royalty-free background music URL (you can replace with your own)
bgMusic.src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3";
bgMusic.volume=0.3;

function toggleMusic(){
    musicEnabled=!musicEnabled;
    if(musicEnabled){
        bgMusic.play();
        document.getElementById("musicToggle").innerText="ðŸ”Š Music ON";
    }else{
        bgMusic.pause();
        document.getElementById("musicToggle").innerText="ðŸ”‡ Music OFF";
    }
}

document.getElementById("musicToggle").onclick=toggleMusic;

// Start playing background music
window.addEventListener("click",()=>{
    if(musicEnabled && bgMusic.paused){
        bgMusic.play();
    }
},{once:true});

/* ===== STATS SYSTEM ===== */

let stats={
    total:0,
    Common:0,
    Rare:0,
    Ultra:0,
    Mythic:0,
    Divine:0
};

function updateStats(){
    document.getElementById("s_total").innerText=stats.total;
    document.getElementById("s_common").innerText=stats.Common;
    document.getElementById("s_rare").innerText=stats.Rare;
    document.getElementById("s_ultra").innerText=stats.Ultra;
    document.getElementById("s_mythic").innerText=stats.Mythic;
    document.getElementById("s_divine").innerText=stats.Divine;
}

/* ===== RNG ===== */

const RARITIES=[
    {name:"Common",chance:55,color:"#888"},
    {name:"Rare",chance:25,color:"#2196f3"},
    {name:"Ultra",chance:15,color:"#9c27b0"},
    {name:"Mythic",chance:4,color:"#ff9800"},
    {name:"Divine",chance:1,color:"#ffd700"}
];

const MEMES=[
    {img:"https://i.imgflip.com/30b1gx.jpg",rarity:"Common"},
    {img:"https://i.imgflip.com/1ur9b0.jpg",rarity:"Rare"},
    {img:"https://i.imgflip.com/2fm6x.jpg",rarity:"Ultra"}
];

const wheel=document.getElementById("wheel");

function buildWheel(){
    wheel.innerHTML="";
    for(let i=0;i<400;i++){ 
        let m=MEMES[i%MEMES.length];
        let r=RARITIES.find(x=>x.name===m.rarity);

        let d=document.createElement("div");
        d.className="item";
        d.style.boxShadow=`0 0 20px ${r.color}`;
        d.innerHTML=`<img src="${m.img}">`;

        wheel.appendChild(d);
    }
}
buildWheel();

function pick(){
    let roll=Math.random()*100;
    let sum=0;
    for(let r of RARITIES){
        sum+=r.chance;
        if(roll<=sum){
            let pool=MEMES.filter(m=>m.rarity===r.name);
            return pool[Math.floor(Math.random()*pool.length)];
        }
    }
    return MEMES[0];
}

/* ===== SPIN SYSTEM ===== */

let spinning=false;
let tickInterval;
let spinStart;

document.getElementById("spinBtn").onclick=startSpin;
document.getElementById("skipBtn").onclick=skipSpin;

function startSpin(){

    if(spinning) return;
    spinning=true;

    wheel.style.transition="none";
    wheel.style.transform="translateX(0px)";
    wheel.offsetHeight;

    let duration=6000;
    spinStart=performance.now();

    startTickSound();
    playSpinSound();

    function anim(t){

        let p=(t-spinStart)/duration;
        if(p>1)p=1;

        let ease=1-Math.pow(1-p,3);
        let move=ease*9000;

        wheel.style.transform=`translateX(-${move}px)`;

        updateTickSpeed(p);

        if(p<1 && spinning){
            requestAnimationFrame(anim);
        }else{
            finishSpin();
        }
    }

    requestAnimationFrame(anim);
}

function startTickSound(){
    let t=document.getElementById("tick");
    tickInterval=setInterval(()=>{
        t.currentTime=0;
        t.play().catch(e=>console.log("Audio play failed:",e));
    },60);
}

function updateTickSpeed(progress){
    clearInterval(tickInterval);
    let speed=60+(progress*300);
    tickInterval=setInterval(()=>{
        let t=document.getElementById("tick");
        t.currentTime=0;
        t.play().catch(e=>console.log("Audio play failed:",e));
    },speed);
}

function playSpinSound(){
    let sound=document.getElementById("spinSound");
    sound.currentTime=0;
    sound.play().catch(e=>console.log("Spin sound failed:",e));
}

function skipSpin(){
    if(!spinning)return;
    spinning=false;
    finishSpin();
}

function finishSpin(){

    clearInterval(tickInterval);

    let meme=pick();
    let r=RARITIES.find(x=>x.name===meme.rarity);

    /* UPDATE STATS */
    stats.total++;
    stats[r.name]++;
    updateStats();

    showPopup(r);
    flash(r.color);

    spinning=false;
}

function showPopup(r){
    let p=document.getElementById("popup");
    p.innerText=r.name;
    p.style.color=r.color;
    p.style.display="block";
    setTimeout(()=>p.style.display="none",1500);
}

function flash(color){
    let f=document.getElementById("flash");
    f.style.background=color;
    f.style.opacity="0.5";
    setTimeout(()=>f.style.opacity="0",300);
}

</script>
</body>
</html>
